import Dashboard from './components/Dashboard';
import ProblemForm from './components/ProblemForm';
import Analytics from './components/Analytics';
import ProblemTabs from './components/ProblemTabs';
import { Home, Plus, List, BarChart3, Moon, Sun, Star, Settings as SettingsIcon, Archive as LearnedIcon } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { useTheme, ThemeProvider } from '@/components/theme-provider';
import { Toaster } from '@/components/ui/sonner';
import { Settings as SettingsComponent } from './components/Settings';
import { Badge } from '@/components/ui/badge';
import { useProblems } from './hooks/useProblems';
import { useContests } from './hooks/useContests';
import { useNotifications } from './hooks/useNotifications';
import { useProblemForm } from './hooks/useProblemForm';



function App() {
  const { theme, setTheme } = useTheme();

  // Custom hooks for state management
  const {
    problems,
    potdProblems,
    activeProblems,
    reviewProblems,
    learnedProblems,
    activePotdProblems,
    reviewPotdProblems,
    dueReviewCount,
    addProblem,
      onProblemReviewed={isPotdList ? handlePotdProblemReviewed : handleProblemReviewed}
          onEditProblem={handleOpenForm}
          isReviewList={isReviewList}
        />
      </TabsContent>
      <TabsContent value="atcoder">
        <ProblemList
          problems={problemsToRender.filter(p => p.platform === 'atcoder')}
          onUpdateProblem={isPotdList ? handleUpdatePotdProblem : handleUpdateProblem}
          onDeleteProblem={isPotdList ? handleDeletePotdProblem : handleDeleteProblem}
          onProblemReviewed={isPotdList ? handlePotdProblemReviewed : handleProblemReviewed}
          onEditProblem={handleOpenForm}
          isReviewList={isReviewList}
        />
      </TabsContent>
    </Tabs>
  );


  return (
    <ThemeProvider defaultTheme="dark" storageKey="vite-ui-theme">
      <div className="min-h-screen bg-background font-sans antialiased">
        <header className="border-b">
          <div className="container mx-auto px-4">
            <div className="flex justify-between items-center h-16">
              <div className="flex items-center space-x-3">
                <div className="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                  <span className="text-primary-foreground font-bold text-sm">LC</span>
                </div>
                <h1 className="text-xl font-semibold">
                  Problem Tracker
                </h1>
              </div>
              
              <div className="flex items-center space-x-4">
                <SettingsComponent onSettingsSave={handleSettingsSave}>
                  <Button variant="ghost" size="icon">
                    <SettingsIcon className="h-6 w-6" />
                  </Button>
                </SettingsComponent>

                <span className="text-sm text-muted-foreground">
                  {problems.length} problem{problems.length !== 1 ? 's' : ''} tracked
                </span>


                {/* {isAuthenticated && currentUser ? (
                  <DropdownMenu>
                    <DropdownMenuTrigger asChild>
                      <Button variant="ghost" size="sm" className="flex items-center space-x-2">
                        <User className="h-4 w-4" />
                        <span className="hidden sm:inline">{currentUser.username}</span>
                      </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent align="end">
                      <DropdownMenuItem onClick={handleLogout}>
                        <LogOut className="mr-2 h-4 w-4" />
                        Logout
                      </DropdownMenuItem>
                    </DropdownMenuContent>
                  </DropdownMenu>
                ) : (
                  <Button variant="outline" size="sm" onClick={() => setShowAuthModal(true)}>
                    <User className="mr-2 h-4 w-4" />
                    Login
                  </Button>
                )} */}

                <Button variant="ghost" size="icon" onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}>
                  <Sun className="h-6 w-6 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
                  <Moon className="absolute h-6 w-6 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
                  <span className="sr-only">Toggle theme</span>
                </Button>
              </div>
            </div>
          </div>
        </header>

       
        <ProblemForm
          open={isFormOpen}
          onOpenChange={setIsFormOpen}
          onAddProblem={handleAddProblem}
          onUpdateProblem={handleUpdateProblem}
          problemToEdit={problemToEdit}
        />

        <main className="container py-8">
          <Tabs defaultValue="dashboard" className="p-4 sm:p-6 md:p-8">
            <div className="flex items-center justify-between pb-4">
              <h1 className="text-2xl sm:text-3xl font-bold tracking-tight text-foreground">
                LEETCODE + CF TRACKER
              </h1>
              <TabsList>
                <TabsTrigger value="dashboard">
                  <Home className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Dashboard</span>
                </TabsTrigger>
                {/* <TabsTrigger value="companies">
                  <Building2 className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Companies</span>
                </TabsTrigger> */}
                {/* <TabsTrigger value="company-problems">
                  <Building2 className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Company Problems</span>
                  {companyProblems.length > 0 && (
                    <Badge variant="secondary" className="ml-2">
                      {companyProblems.length}
                    </Badge>
                  )}
                </TabsTrigger> */}
                {/* <TabsTrigger value="potd">
                  <History className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">POTD</span>
                </TabsTrigger> */}
                {/* <TabsTrigger value="contests">
                  <Trophy className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Contests</span>
                </TabsTrigger> */}
                <TabsTrigger value="problems">
                  <List className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Problems</span>
                </TabsTrigger>
                <TabsTrigger value="review">
                  <Star className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Review</span>
                  {dueReviewCount > 0 && (
                    <Badge variant="destructive" className="ml-2">
                      {dueReviewCount}
                    </Badge>
                  )}
                </TabsTrigger>
                <TabsTrigger value="learned">
                  <LearnedIcon className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Learned</span>
                </TabsTrigger>
                <TabsTrigger value="analytics">
                  <BarChart3 className="h-5 w-5 sm:mr-2" />
                  <span className="hidden sm:inline">Analytics</span>
                </TabsTrigger>
               
              </TabsList>
            </div>

            <TabsContent value="dashboard">
              <Dashboard
                problems={activeProblems}
                onUpdateProblem={handleUpdateProblem}
                onAddPotd={handleAddPotdProblem}
                onImportProblems={handleImportProblems}
              />
            </TabsContent>
            <TabsContent value="companies">
              <CompanyView
                problems={problems}
                onUpdateProblem={handleUpdateProblem}
                onDeleteProblem={handleDeleteProblem}
                onEditProblem={handleOpenForm}
                onProblemReviewed={handleProblemReviewed}
              />
            </TabsContent>
            {/* <TabsContent value="company-problems">
              <CompanyProblemsView
                companyProblems={companyProblems}
                onMarkAsSolved={handleMarkCompanyProblemAsSolved}
                onRemoveProblem={handleRemoveCompanyProblem}
              />
            </TabsContent> */}
            <TabsContent value="potd">
              {renderProblemList(potdProblems, true)}
            </TabsContent>
            <TabsContent value="contests">
              <ContestTracker
                contests={contests}
                onAddContest={handleAddContest}
                onUpdateContest={handleUpdateContest}
                onDeleteContest={handleDeleteContest}
              />
            </TabsContent>
            <TabsContent value="problems">
              <div className="flex justify-end pb-4">
                <Button onClick={() => handleOpenForm()}>
                  <div className="flex items-center">
                    <Plus className="h-5 w-5 mr-2" />
                    <span>Add Problem</span>
                  </div>
                </Button>
              </div>
              {renderProblemList(activeProblems)}
            </TabsContent>
            <TabsContent value="review">
              {renderProblemList([...reviewProblems, ...reviewPotdProblems], false, true)}
            </TabsContent>
            <TabsContent value="learned">
                {renderProblemList(learnedProblems)}
            </TabsContent>
            <TabsContent value="analytics">
              <Analytics problems={problems} />
            </TabsContent>
        
          </Tabs>
        </main>
        <Toaster />
      </div>
    </ThemeProvider>
  );
}

export default App;
() => {} <ProblemForm
          open={isFormOpen}
          onOpenChange={setIsFormOpen}
          onAddProblem={addProblem}
          onUpdateProblem={uupdateProblem}
                onAddPotd={addPotdProblem}
                onImportProblems={importProblems}
              />
            </TabsContent>

            <TabsContent value="problems">
              <div className="flex justify-end pb-4">
                <Button onClick={() => openForm()}>
                  <div className="flex items-center">
                    <Plus className="h-5 w-5 mr-2" />
                    <span>Add Problem</span>
                  </div>
                </Button>
              </div>
              <ProblemTabs
                problems={activeProblems}
                onUpdateProblem={updateProblem}
                onDeleteProblem={deleteProblem}
                onProblemReviewed={markProblemReviewed}
                onEditProblem={openForm}
              />
            </TabsContent>

            <TabsContent value="review">
              <ProblemTabs
                problems={[...reviewProblems, ...reviewPotdProblems]}
                isPotdList={false}
                isReviewList={true}
                onUpdateProblem={updateProblem}
                onDeleteProblem={deleteProblem}
                onProblemReviewed={markProblemReviewed}
                onEditProblem={openForm}
              />
            </TabsContent>

            <TabsContent value="learned">
              <ProblemTabs
                problems={learnedProblems}
                onUpdateProblem={updateProblem}
                onDeleteProblem={deleteProblem}
                onProblemReviewed={markProblemReviewed}
                onEditProblem={openForm}
              />
            </TabsContent>
